<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loja Exemplo — Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#06132a;
      --card:#0b2033;
      --muted:#9fb6d0;
      --accent:#0b6fb6;
      --accent-dark:#084f83;
      --btn-bg:linear-gradient(90deg,#1fb6ff,#3b82f6);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg) 0%, #07132a 70%);color:#e6eef8;min-height:100vh;display:flex;flex-direction:column}
    header.topbar{display:grid;grid-template-columns:240px 1fr 260px;gap:12px;align-items:center;padding:12px 20px;background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#fff;position:relative;z-index:2000}
    .logo{background:rgba(255,255,255,0.06);color:#fff;width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800}
    .search{width:100%;padding:10px 14px;border-radius:6px;border:none;outline:none}
    .auth{display:flex;gap:12px;align-items:center;justify-content:flex-end}
    .auth button{background:none;border:none;cursor:pointer;font-weight:700;color:#fff;text-decoration:none}
    .profileBtn{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 10px;border-radius:8px;display:flex;align-items:center;gap:8px;cursor:pointer;color:#fff}
    .menu{position:absolute;right:0;top:calc(100% + 8px);background:linear-gradient(180deg,#072033,#0b2436);color:#fff;border-radius:8px;min-width:180px;box-shadow:0 10px 30px rgba(0,0,0,0.35);overflow:hidden;display:none;z-index:2100}
    main{flex:1;padding:28px;display:flex;justify-content:center}
    .container{max-width:1200px;width:100%}
    .hero{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .newsletter{display:flex;gap:8px;margin-top:12px}
    .newsletter input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn-primary{background:var(--btn-bg);color:#061226;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:26px}
    .card-prod{background:#fff;padding:12px;border-radius:10px;color:#111}
    .card-prod img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    footer{padding:18px 20px;color:var(--muted);background:transparent;border-top:1px solid rgba(255,255,255,0.03)}
    @media(max-width:980px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:repeat(2,1fr)} header.topbar{grid-template-columns:1fr 1fr} .search{display:none} }
    @media(max-width:640px){ .grid{grid-template-columns:1fr} }
    /* pequenos ajustes de link */
    a.btn-link { color:#fff; font-weight:700; text-decoration:none; background:transparent; border:1px solid rgba(255,255,255,0.04); padding:8px 10px; border-radius:8px; }
  </style>
</head>
<body>

  <header class="topbar" role="banner">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo">LX</div>
      <div style="font-weight:800;color:#fff">Loja Exemplo</div>
    </div>

    <div>
      <input class="search" placeholder="Buscar produtos, marcas e muito mais..." aria-label="Buscar">
    </div>

    <div class="auth" id="authArea">
      <div id="guestArea" style="display:flex;gap:10px;align-items:center">
        <!-- AGORA redirecionam para a página de login -->
        <button id="createBtn" type="button">Criar conta</button>
        <button id="loginBtn" type="button">Entrar</button>
      </div>

      <div id="userArea" style="display:none;align-items:center">
        <div class="dropdown">
          <button id="profileBtn" class="profileBtn" aria-haspopup="true" aria-expanded="false">
            <span id="profileName">Usuário</span>
            <svg width="14" height="10" viewBox="0 0 24 24" fill="none" style="opacity:0.8"><path d="M6 9l6 6 6-6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div id="profileMenu" class="menu" role="menu" aria-hidden="true">
            <a id="myAccount" href="#">Minha conta</a>
            <a id="insightsLink" href="admin.html" style="display:none">Insights</a>
            <button id="logoutBtnMenu" type="button">Sair</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="hero">
        <div>
          <h1 style="color:#fff;margin:0 0 10px">Produtos que fazem a diferença — entregue rápido</h1>
          <p style="color:var(--muted);margin:0 0 12px">Design moderno, qualidade e preço justo. Veja ofertas e produtos antes de entrar.</p>

          <div class="card">
            <form id="newsletterForm" class="newsletter" onsubmit="subscribe(event)">
              <input id="newsletterEmail" type="email" placeholder="seu@exemplo.com" required>
              <button class="btn-primary" type="submit">Assinar</button>
            </form>
            <div id="newsletterMsg" style="color:var(--muted);margin-top:10px;font-size:14px"></div>
          </div>

          <section id="productsSection">
            <h2 style="color:#fff;margin-top:22px">Produtos em destaque</h2>
            <div class="grid" id="productsGrid">
              <div class="card-prod"><img src="https://picsum.photos/seed/prod1/600/400" alt=""><h4>Tênis Urbano</h4><div style="font-weight:800">R$ 249,00</div></div>
              <div class="card-prod"><img src="https://picsum.photos/seed/prod2/600/400" alt=""><h4>Mochila Tech</h4><div style="font-weight:800">R$ 189,00</div></div>
              <div class="card-prod"><img src="https://picsum.photos/seed/prod3/600/400" alt=""><h4>Fone Wireless</h4><div style="font-weight:800">R$ 129,00</div></div>
            </div>
          </section>
        </div>

        <div class="card" aria-hidden="true" style="text-align:center">
          <img src="https://picsum.photos/seed/loja1/800/520" alt="Destaque" style="width:100%;border-radius:10px;display:block">
        </div>
      </div>
    </div>
  </main>

  <footer>
    © <span id="year"></span> Loja Exemplo — todos os direitos reservados
  </footer>

  <!-- OBS: NÃO há mais abertura de modal aqui — os botões redirecionam para login.html -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Supabase client (mantive sua configuração)
      const SUPABASE_URL = 'https://atjeaedbncwcgkwfnrmr.supabase.co';
      const SUPABASE_KEY = 'sb_publishable_lXnKm0nBA8HC-6clDXTAYw_f8-xXiNe';
      if (!window.supabaseClient) window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      const supabase = window.supabaseClient;

      // Elementos
      const createBtn = document.getElementById('createBtn');
      const loginBtn = document.getElementById('loginBtn');

      // Ao invés de abrir modal, redireciona para login.html (com hash para signup)
      createBtn?.addEventListener('click', (e) => {
        e.preventDefault();
        // redireciona para a aba 'Criar conta'
        window.location.href = 'login.html#signup';
      });
      loginBtn?.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = 'login.html';
      });

      // Header / autenticação mínima (mantive a lógica para mostrar usuário quando logado)
      const guestArea = document.getElementById('guestArea');
      const userArea = document.getElementById('userArea');
      const profileBtn = document.getElementById('profileBtn');
      const profileMenu = document.getElementById('profileMenu');
      const profileName = document.getElementById('profileName');
      const logoutBtnMenu = document.getElementById('logoutBtnMenu');
      const insightsLink = document.getElementById('insightsLink');

      if (profileBtn) {
        profileBtn.addEventListener('click', () => {
          const shown = profileMenu.style.display === 'block';
          profileMenu.style.display = shown ? 'none' : 'block';
          profileBtn.setAttribute('aria-expanded', (!shown).toString());
        });
      }
      document.addEventListener('click', (e) => {
        if (!profileBtn?.contains(e.target) && !profileMenu?.contains(e.target)) {
          if (profileMenu) profileMenu.style.display = 'none';
          if (profileBtn) profileBtn.setAttribute('aria-expanded','false');
        }
      });

      logoutBtnMenu?.addEventListener('click', async () => {
        await supabase.auth.signOut();
        window.location.reload();
      });

      async function updateHeader() {
        const { data } = await supabase.auth.getUser();
        const user = data.user ?? null;
        if (!user) {
          guestArea && (guestArea.style.display = 'flex');
          userArea && (userArea.style.display = 'none');
          return;
        }
        guestArea && (guestArea.style.display = 'none');
        userArea && (userArea.style.display = 'flex');

        const { data: profile } = await supabase.from('profiles').select('nome, role').eq('id', user.id).single().catch(()=>({data:null}));
        profileName.textContent = (profile && profile.nome) ? profile.nome : (user.email || 'Usuário');
        if (profile && profile.role === 'admin') insightsLink.style.display = 'block'; else insightsLink.style.display = 'none';
      }

      supabase.auth.onAuthStateChange((_event, session) => {
        updateHeader();
      });

      // newsletter
      const newsletterForm = document.getElementById('newsletterForm');
      newsletterForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const newsletterMsg = document.getElementById('newsletterMsg');
        newsletterMsg.textContent = '';
        const email = document.getElementById('newsletterEmail').value.trim();
        if (!email) { newsletterMsg.textContent = 'Informe um email válido.'; return; }
        try {
          const { error } = await supabase.from('respostas').insert([{ nome: 'Newsletter', email }]);
          if (error) { console.error(error); newsletterMsg.textContent = 'Erro ao salvar — veja console.'; }
          else { newsletterMsg.textContent = 'Inscrição realizada com sucesso!'; e.target.reset(); }
        } catch (err) { console.error(err); newsletterMsg.textContent = 'Erro inesperado.'; }
      });

      updateHeader();
      document.getElementById('year').textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>
