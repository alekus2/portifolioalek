<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loja Exemplo — Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#07102a; --card:#0b1220; --muted:#94a3b8; --accent:#ffe600; --accent-dark:#f0c400;
      --btn-bg:linear-gradient(90deg,#06b6d4,#7c3aed);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071024 0%, #07132a 70%);color:#111;min-height:100vh;display:flex;flex-direction:column}
    /* Topbar estilo mercado livre-like */
    header.topbar{display:grid;grid-template-columns:240px 1fr 260px;gap:12px;align-items:center;padding:12px 20px;background:var(--accent);color:#111}
    .logo{background:#111;color:var(--accent);width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800}
    .search{width:100%;padding:10px 14px;border-radius:6px;border:none;outline:none}
    .auth{display:flex;gap:12px;align-items:center;justify-content:flex-end}
    .auth a, .auth button{background:none;border:none;cursor:pointer;font-weight:700;color:#111;text-decoration:none}
    .profileBtn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;display:flex;align-items:center;gap:8px;cursor:pointer}
    .dropdown{position:relative}
    .menu{position:absolute;right:0;top:calc(100% + 8px);background:white;color:#111;border-radius:8px;min-width:180px;box-shadow:0 10px 30px rgba(0,0,0,0.15);overflow:hidden;display:none}
    .menu a, .menu button{display:block;padding:10px 12px;text-decoration:none;color:inherit;border:none;background:none;text-align:left;width:100%;cursor:pointer}
    .menu a:hover, .menu button:hover{background:#f3f3f3}
    main{flex:1;padding:28px;display:flex;justify-content:center}
    .container{max-width:1200px;width:100%}
    .hero{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .newsletter{display:flex;gap:8px;margin-top:12px}
    .newsletter input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06)}
    .btn-primary{background:var(--btn-bg);color:#061226;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    /* product grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:26px}
    .card-prod{background:white;padding:12px;border-radius:10px;color:#111}
    .card-prod img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    footer{padding:18px 20px;color:#94a3b8;background:transparent;border-top:1px solid rgba(255,255,255,0.03)}
    @media(max-width:980px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:repeat(2,1fr)} header.topbar{grid-template-columns:1fr} .search{display:none} }
    @media(max-width:640px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>

  <header class="topbar" role="banner">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo">LX</div>
      <div style="font-weight:800">Loja Exemplo</div>
    </div>

    <div>
      <input class="search" placeholder="Buscar produtos, marcas e muito mais..." aria-label="Buscar">
    </div>

    <div class="auth" id="authArea">
      <!-- estado para anon -->
      <div id="guestArea" style="display:flex;gap:10px;align-items:center">
        <a href="login.html" id="createBtn">Criar conta</a>
        <a href="login.html" id="loginBtn">Entrar</a>
      </div>

      <!-- estado para usuario -->
      <div id="userArea" style="display:none;align-items:center">
        <div class="dropdown">
          <button id="profileBtn" class="profileBtn" aria-haspopup="true" aria-expanded="false">
            <span id="profileName">Usuário</span>
            <svg width="14" height="10" viewBox="0 0 24 24" fill="none" style="opacity:0.8"><path d="M6 9l6 6 6-6" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div id="profileMenu" class="menu" role="menu" aria-hidden="true">
            <a id="myAccount" href="#">Minha conta</a>
            <a id="insightsLink" href="admin.html" style="display:none">Insights</a>
            <button id="logoutBtnMenu">Sair</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="hero">
        <div>
          <h1 style="color:#fff;margin:0 0 10px">Produtos que fazem a diferença — entregue rápido</h1>
          <p style="color:#cbd5e1;margin:0 0 12px">Design moderno, qualidade e preço justo. Veja ofertas e produtos antes de entrar.</p>

          <div class="card">
            <form id="newsletterForm" class="newsletter" onsubmit="subscribe(event)">
              <input id="newsletterEmail" type="email" placeholder="seu@exemplo.com" required>
              <button class="btn-primary" type="submit">Assinar</button>
            </form>
            <div id="newsletterMsg" style="color:#94a3b8;margin-top:10px;font-size:14px"></div>
          </div>

          <section id="productsSection">
            <h2 style="color:#fff;margin-top:22px">Produtos em destaque</h2>
            <div class="grid" id="productsGrid">
              <!-- cards de exemplo -->
              <div class="card-prod"><img src="https://picsum.photos/seed/prod1/600/400" alt=""><h4>Tênis Urbano</h4><div style="font-weight:800">R$ 249,00</div></div>
              <div class="card-prod"><img src="https://picsum.photos/seed/prod2/600/400" alt=""><h4>Mochila Tech</h4><div style="font-weight:800">R$ 189,00</div></div>
              <div class="card-prod"><img src="https://picsum.photos/seed/prod3/600/400" alt=""><h4>Fone Wireless</h4><div style="font-weight:800">R$ 129,00</div></div>
            </div>
          </section>
        </div>

        <div class="card" aria-hidden="true" style="text-align:center">
          <img src="https://picsum.photos/seed/loja1/800/520" alt="Destaque" style="width:100%;border-radius:10px;display:block">
        </div>
      </div>
    </div>
  </main>

  <footer>
    © <span id="year"></span> Loja Exemplo — todos os direitos reservados
  </footer>

  <!-- Supabase client (único include; usa sua url/key) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // config
    const SUPABASE_URL = 'https://xqsuvwagygwkkugjqgpu.supabase.co';
    const SUPABASE_KEY = 'sb_publishable__lu67DW_OZJ_kbIw_aY3-Q_AI-DQvH1';

    if (!window.supabaseClient) {
      window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    }
    const supabase = window.supabaseClient;

    document.getElementById('year').textContent = new Date().getFullYear();

    // UI refs
    const guestArea = document.getElementById('guestArea');
    const userArea = document.getElementById('userArea');
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    const profileName = document.getElementById('profileName');
    const logoutBtnMenu = document.getElementById('logoutBtnMenu');
    const insightsLink = document.getElementById('insightsLink');

    // toggle dropdown
    profileBtn.addEventListener('click', () => {
      const shown = profileMenu.style.display === 'block';
      profileMenu.style.display = shown ? 'none' : 'block';
      profileBtn.setAttribute('aria-expanded', (!shown).toString());
    });
    // close when click outside
    document.addEventListener('click', (e) => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.style.display = 'none';
        profileBtn.setAttribute('aria-expanded','false');
      }
    });

    logoutBtnMenu.addEventListener('click', async () => {
      await supabase.auth.signOut();
      await updateHeader();
    });

    // update header based on auth state
    async function updateHeader() {
      const { data } = await supabase.auth.getUser();
      const user = data.user ?? null;

      if (!user) {
        guestArea.style.display = 'flex';
        userArea.style.display = 'none';
        return;
      }

      // show user area and load profile
      guestArea.style.display = 'none';
      userArea.style.display = 'flex';

      const { data: profile, error } = await supabase
        .from('profiles')
        .select('nome, role')
        .eq('id', user.id)
        .single();

      profileName.textContent = (profile && profile.nome) ? profile.nome : (user.email || 'Usuário');

      // show Insights link only if role == 'admin'
      if (profile && profile.role === 'admin') {
        insightsLink.style.display = 'block';
      } else {
        insightsLink.style.display = 'none';
      }
    }

    // subscribe to auth changes
    supabase.auth.onAuthStateChange((_event, session) => {
      updateHeader();
    });

    // initial check
    (async () => { await updateHeader(); })();

    // newsletter behavior
    const newsletterForm = document.getElementById('newsletterForm');
    const newsletterMsg = document.getElementById('newsletterMsg');

    newsletterForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      newsletterMsg.textContent = '';
      const email = document.getElementById('newsletterEmail').value.trim();
      if (!email) { newsletterMsg.textContent = 'Informe um email válido.'; return; }

      const { error } = await supabase.from('respostas').insert([{ nome: 'Newsletter', email }]);
      if (error) {
        console.error(error);
        newsletterMsg.textContent = 'Erro ao salvar — veja console.';
      } else {
        newsletterMsg.textContent = 'Inscrição realizada com sucesso!';
        e.target.reset();
      }
    });
  </script>
</body>
</html>
